<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <script type="text/javascript" src="//api.map.baidu.com/api?v=2.0&ak=mbGaw3oXwuedTf85v3pr2Wj50k7lkqNK"></script>
    <script type="text/javascript" src="//api.map.baidu.com/library/Heatmap/2.0/src/Heatmap_min.js"></script>
    <title>热力图功能示例</title>
    <style type="text/css">
		ul,li{list-style: none;margin:0;padding:0;float:left;}
		html{height:100%}
		body{height:100%;margin:0px;padding:0px;font-family:"微软雅黑";}
		#container{height:500px;width:100%;}
		#r-result{width:100%;}
    </style>
</head>
<body>
	<div id="container"></div>
	<div id="r-result">
		<input type="button"  onclick="openHeatmap();" value="显示热力图"/><input type="button"  onclick="closeHeatmap();" value="关闭热力图"/>
	</div>
</body>
</html>
<script type="text/javascript">
    var map = new BMap.Map("container");          // 创建地图实例

    var point = new BMap.Point(116.418261, 39.921984);
    map.centerAndZoom(new BMap.Point(105.000, 38.000), 5);     // 初始化地图,设置中心点坐标和地图级别
    map.enableScrollWheelZoom(); // 允许滚轮缩放

    var points =[{"lat":39.910924547299565,"lng":116.4133836971231,"count":6047},{"lat":31.235929042252014,"lng":121.48053886017651,"count":2268},{"lat":22.548456637984177,"lng":114.06455183658751,"count":1884},{"lat":30.25308298169347,"lng":120.21551180372168,"count":1137},{"lat":23.135336306695006,"lng":113.27143134445974,"count":997},{"lat":30.655821878416408,"lng":104.08153351042463,"count":441},{"lat":30.598466736400987,"lng":114.31158155473231,"count":288},{"lat":32.06465288561847,"lng":118.80242172124585,"count":189},{"lat":24.485406605176305,"lng":118.09643549976651,"count":116},{"lat":42.933308420624584,"lng":125.15537330312809,"count":110},{"lat":28.23488939994364,"lng":112.94547319535287,"count":106},{"lat":31.303564074441766,"lng":120.59241222959322,"count":97},{"lat":29.568996245338923,"lng":106.55843415537664,"count":73},{"lat":34.75343885045448,"lng":113.63141920733915,"count":33},{"lat":23.02775875078891,"lng":113.12851219549718,"count":27},{"lat":39.143929903310074,"lng":117.21081309155257,"count":27},{"lat":22.27656465424921,"lng":113.58255478654918,"count":25},{"lat":26.080429420698078,"lng":119.30346983854001,"count":21},{"lat":36.65655420178723,"lng":117.12639941261048,"count":20},{"lat":31.826577833686887,"lng":117.23344266497664,"count":18},{"lat":38.9189536667856,"lng":121.62163148459285,"count":18},{"lat":29.866033045866054,"lng":121.62857249434141,"count":13},{"lat":23.02730841164339,"lng":113.75842045787648,"count":12},{"lat":31.498809732685714,"lng":120.31858328810601,"count":10},{"lat":22.822606601187154,"lng":108.37345082581861,"count":10},{"lat":26.653324822309752,"lng":106.63657676352776,"count":8},{"lat":31.815795653327836,"lng":119.98148471327892,"count":8},{"lat":38.0483119268727,"lng":114.52153190157445,"count":8},{"lat":24.873998150044006,"lng":102.85244836500482,"count":8},{"lat":28.68945529506072,"lng":115.86458944231661,"count":7},{"lat":36.067234693545565,"lng":103.84052119633628,"count":5},{"lat":41.720915668888956,"lng":123.4559899308919,"count":5},{"lat":37.470038383730525,"lng":121.45441541730195,"count":4},{"lat":36.072227496663224,"lng":120.38945519114627,"count":4},{"lat":30.750974830920143,"lng":120.76355182586005,"count":3},{"lat":24.879952330498313,"lng":118.68244626680422,"count":3},{"lat":38.87998776845534,"lng":115.47146383768579,"count":3},{"lat":26.804452789023987,"lng":104.02261222215063,"count":2},{"lat":31.676265597609103,"lng":118.5135795794315,"count":2},{"lat":32.19471592052375,"lng":119.43048944567383,"count":2},{"lat":43.82195350104314,"lng":125.3306020759069,"count":2},{"lat":39.941748102377936,"lng":119.60853063334328,"count":2},{"lat":34.21266655011306,"lng":117.29057543439453,"count":2},{"lat":22.29358599327966,"lng":114.18612410257077,"count":2},{"lat":34.335476293368586,"lng":108.71542245143303,"count":1},{"lat":27.820856421848216,"lng":114.4235636759064,"count":1},{"lat":25.242885724872647,"lng":110.20354537457943,"count":1},{"lat":31.206748720157083,"lng":121.42171529922942,"count":1},{"lat":30.0363693113069,"lng":120.58547847885335,"count":1},{"lat":22.204117988443336,"lng":113.55751910182492,"count":1},{"lat":38.492460055509596,"lng":106.23849358740017,"count":1},{"lat":35.420177394529645,"lng":116.59361234853988,"count":1},{"lat":34.04143161161871,"lng":113.85847553685502,"count":1},{"lat":31.473663048745863,"lng":104.6855618607612,"count":1},{"lat":35.23940742476551,"lng":115.48754503343376,"count":1},{"lat":28.460625921851733,"lng":117.94945960312224,"count":1},{"lat":39.63658372414733,"lng":118.18645947203979,"count":1},{"lat":23.116358854725593,"lng":114.4235580165817,"count":1},{"lat":36.62338469651661,"lng":101.78445017050855,"count":1},{"lat":24.815881278583017,"lng":113.60352734562261,"count":1},{"lat":23.35909171772515,"lng":116.68852864054833,"count":1},{"lat":21.276723439012073,"lng":110.36555441392824,"count":1},{"lat":39.926374523079886,"lng":116.44955872950158,"count":1},{"lat":20.04404943925674,"lng":110.32552547126409,"count":1},{"lat":38.92451111549568,"lng":121.65154739366945,"count":1},{"lat":36.2058580448846,"lng":117.0944948347959,"count":1},{"lat":32.99656220465144,"lng":112.53450131351325,"count":1},{"lat":24.294177532206206,"lng":116.12953737612247,"count":1},{"lat":37.87698902884778,"lng":112.55639149167204,"count":1},{"lat":27.575160902978517,"lng":110.00851426537254,"count":1},{"lat":45.808825827952184,"lng":126.54161509031663,"count":1},{"lat":36.71265155126753,"lng":119.16837791142822,"count":1},{"lat":37.524497749577115,"lng":111.15044967529185,"count":1}];

    if(!isSupportCanvas()){
    	alert('热力图目前只支持有canvas支持的浏览器,您所使用的浏览器不能使用热力图功能~')
    }
	//详细的参数,可以查看heatmap.js的文档 https://github.com/pa7/heatmap.js/blob/master/README.md
	//参数说明如下:
	/* visible 热力图是否显示,默认为true
     * opacity 热力的透明度,1-100
     * radius 势力图的每个点的半径大小
     * gradient  {JSON} 热力图的渐变区间 . gradient如下所示
     *	{
			.2:'rgb(0, 255, 255)',
			.5:'rgb(0, 110, 255)',
			.8:'rgb(100, 0, 255)'
		}
		其中 key 表示插值的位置, 0~1.
		    value 为颜色值.
     */
	heatmapOverlay = new BMapLib.HeatmapOverlay({"radius":20});
	map.addOverlay(heatmapOverlay);
	heatmapOverlay.setDataSet({data:points,max:100});
	//是否显示热力图
    function openHeatmap(){
        heatmapOverlay.show();
    }
	function closeHeatmap(){
        heatmapOverlay.hide();
    }
	closeHeatmap();
    function setGradient(){
     	/*格式如下所示:
		{
	  		0:'rgb(102, 255, 0)',
	 	 	.5:'rgb(255, 170, 0)',
		  	1:'rgb(255, 0, 0)'
		}*/
     	var gradient = {};
     	var colors = document.querySelectorAll("input[type='color']");
     	colors = [].slice.call(colors,0);
     	colors.forEach(function(ele){
			gradient[ele.getAttribute("data-key")] = ele.value;
     	});
        heatmapOverlay.setOptions({"gradient":gradient});
    }
	//判断浏览区是否支持canvas
    function isSupportCanvas(){
        var elem = document.createElement('canvas');
        return !!(elem.getContext && elem.getContext('2d'));
    }
</script>